---
layout: post
title:  "视音频数据处理入门：RGB、YUV像素数据处理"
image: ''
date:   2021-02-01 11:28:08
tags:
- FFMPEG
description: ''
categories: 
- FFMPEG
---
# YUV
## WIKI
```
YUV是一种彩色编码系统，通常用作彩色图像管线的一部分。它考虑到人类的感知对彩色图像或视频进行编码，从而减少了色度分量的带宽，从而与使用“直接” RGB表示相比，通常可以使人类的感知更有效地掩盖传输错误或压缩伪像。其他颜色编码具有相似的属性，实现或研究Y'UV属性的主要原因是与符合某些Y'UV标准的模拟或数字电视或摄影设备接口。
```
```
Y'UV模型根据一个亮度分量（Y'）和两个色度分量（分别称为U（蓝色投影）和V（红色投影））定义了色彩空间。Y'UV颜色模型用于PAL复合彩色视频（不包括PAL-N）标准中。先前的黑白系统仅使用亮度（Y'）信息。颜色信息（U和V）是通过副载波单独添加的，因此黑白接收器仍然能够以接收器的本机黑白格式接收和显示彩色图片传输。
```
```
Y'代表亮度分量（亮度），U和V代表色度（颜色）分量；亮度用Y表示，亮度用Y'表示–质数符号（'）表示伽玛校正，[1]的“亮度”表示物理线性空间亮度，而“亮度”表示（非线性）感知亮度。
```
```
术语Y'UV，YUV，YCbCr，YPbPr等的范围有时是模棱两可和重叠的。历史上，术语YUV和Y'UV用于电视系统中颜色信息的特定模拟编码，而YCbCr用于颜色信息的数字编码，适用于视频和静止图像压缩和传输，例如MPEG和JPEG。[2]今天，术语YUV在计算机行业中通常用于描述使用YCbCr编码的文件格式。
```
```
模拟分量视频中使用的YPbPr颜色模型和数字视频中使用的数字版本YCbCr或多或少都源于它，有时也称为Y'UV。（C B / P B和C R / P R是在蓝黄色和红色-青色轴上偏离灰色的值，而U和V分别是蓝色-亮度和红色-亮度差。）Y'IQ颜色空间用于模拟NTSC电视广播系统与此相关，尽管方式更为复杂。在模拟SECAM和PAL-N电视广播系统中使用的YDbDr色彩空间也与此相关。
```
```
至于词源，Y，Y'，U和V不是缩写。字母Y用于亮度的使用可以追溯到XYZ原色的选择。这自然适合于在亮度（Y'）中使用相同的字母，该字母近似于亮度的感知均匀相关。同样，选择U和V可以将U和V轴与其他空间（例如x和y色度空间）中的U和V轴区分开
```
**人眼对亮度的感知比较敏感，而对色度感知比较弱，所以可以压缩UV的大小而并不明显改变图像质量。**



**YUV 颜色编码采用的是 明亮度 和 色度 来指定像素的颜色，而色度又定义了颜色的两个方面：色调和饱和度。**
* Y 表示明亮度（Luminance、Luma）
* U 和 V 表示色度（Chrominance、Chroma）（U，V 分别是蓝色通道和红色通道）
![图片](..\assets\img\opengl\yuv.jpg)  
* Y 通道数值越高，图片则越亮
* U 通道数值越高，颜色就越接近蓝色
* V 通道数值越高，颜色就越接近红色


### RGB和YUV的转换公式
![图片](..\assets\img\opengl\convert.png)

## YUV的宏观存储方式

在宏观上，YUV有两种存储方式：planar、packed。

planar：从字面意思上来看，planar是平面的意思，平面比较平整，对应到存储方式上就是把YUV三种分量分别存储，以I420为例，存储方式为：YYYYYYYYUUVV，简单明了，先把Y存完，再存U，再存V，这种在解析时很方便

packed：从字面意思来看，packed是打包的意思，打包就不一定是平整的了，对应到存储方式上就是把YUV三种分量交叉存储，以YUY2为例，存储方式为：Y0U0Y1V0 Y2U1Y3V1，这种方式在解析时就会比较麻烦  

## 采样方式

采样方式即如何表现一个像素，现在主流的有三种采样方式，
* 4：4：4
* 4：2：2
* 4：2：0
这三种比例是YUV三种分量的比例，咱们前面说过像素是用YUV三个分量控制显示的，所以一个像素应该包含一个Y，一个U，一个V，如果要完全存储，那一个一个像素点就要存储YUV三个分量，这种形式就是4：4：4了。   
但是因为人的眼睛对色度和饱和度不是特别敏感，所以一定程度上丢失一部分UV并不影响我们分辨颜色，所以聪明的先驱们为了节省存储空间，在存储时就故意丢掉部分UV分量，用两个Y分量共用一组UV分量，这种形式就是4：2：2,或用四个Y分量共用一组UV，这种形式就是4：2：0了

下图中以黑点表示采样该像素点的Y分量，以空心圆圈表示采用该像素点的UV分量
![图片](..\assets\img\opengl\459321-20190425114835338-251896186.png)  


**在存储时YUV各占一个字节Byte.**   
* 4：4：4方式，那一个256X256分辨率的图片要占用256×256×3=196608Byte
* 4：2：2方式要占用256×256×2=131072Byte
* 4：2：0方式要占用256×256×1.5=43690.7Byte  
**可以看到采用4：2：0方式存储空间整整减少了一半**  

## 常见存储格式
### YU12/I420  
该格式属于4：2：0类型，存储方式上面已经说过，就是先存储把全部的Y分量存完，再存U分量，最后存V分量，从网上找了一张很形象的图：  
![图片](..\assets\img\opengl\459321-20190425114904509-246604105.png)  

可以看到，第一行的Y1Y2和第二行的Y7Y8共同使用一组UV分量U1V1。

### YV12  
该格式与YU12基本一样，唯一的区别是先存储V分量再存储U分量，对应到上图把第五行和第六行位置互换一下就是了。

__以上两种格式我们可以看到都是4：2：0的，因为都是planar方式存储，简称420p。__

### NV12
该格式是先存储全部的Y分量，然后UV分量交叉存储，用图像表示下:
![图片](..\assets\img\opengl\459321-20190425114931566-890327817.png)  
### NV21
![图片](..\assets\img\opengl\459321-20190425114946159-1059189537.png)  
**上面两种虽然也是4：2：0类型，但是并不是完全的planar格式，所以又称为420sp，与420p进行区分。**
  
**下面说几个4：2：2类型较常见的**  

### YUV422P
名字中带P表示是planar格式存储，该格式存储方式与I420是一样的，唯一的区别是UV分量的数量不同，I420中四个Y共用一组UV，而该格式中两个Y共用一组UV，也就是说UV分量相对于I420在数量上多了一倍，从网上找了一张图，如下：  
![图片](..\assets\img\opengl\459321-20190425115215073-1428674712.png)  


### YUV图像
![图片](..\assets\img\opengl\20160117232415153.yuv)
### Y分量图片
![图片](..\assets\img\opengl\20160117232435874.png)  
### U分量图片
![图片](..\assets\img\opengl\20160117232500394.png)
### V分量图片
![图片](..\assets\img\opengl\20160117232505751.png)