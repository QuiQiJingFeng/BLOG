---
layout: post
title:  "Unity UI相关"
image: ''
date:   2021-06-02 16:42:32
tags:
- Unity
description: ''
categories: 
- Unity
---
在游戏开发过程中，为了增强游戏与玩家的交互性，开发人员往往会通过制作大量的图形用户界面（Graphical User Interface，GUI）来增强这一效果。

Unity 3D 中的图形系统分为 OnGUI、NGUI、UGUI 等，这些类型的图形系统内容十分丰富，包含游戏中通常使用到的按钮、图片、文本等控件。

本章将详细介绍如何使用 OnGUI 与 UGUI 两种图形系统来开发游戏中常见的图形用户界面，其中包括各种参数的功能简介及控件的使用方法。

**早期的 Unity 3D 采用的是 OnGUI 系统，后来进展到了 NGUI 系统,在 Unity 4.6 以后 Unity 官方推出了新的 UGUI 系统，采用全新的独立坐标系，为游戏开发者提供了更高的运转效率**


# OnGUI 常用控件
[教程链接](http://c.biancheng.net/view/2688.html)
```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Player : MonoBehaviour
{
    public Texture image;
    string _stringToEdit = "Hello World";
    string _stringToArea = "Text Area";

    float _hSliderValue = 0.0f;
    float _vSliderValue = 0.0f;
    Vector2 _scrollPosition;

    int _toolBarValue = 0;

    Rect _windowRect = new Rect(0,800,120,50);

    public GUISkin customSkin;
    // Start is called before the first frame update

    bool _checkBox = false;
    void Start()
    {
        
 
    }

    // Update is called once per frame
    void Update()
    {
 
    }
 
    void OnGUI()
    {

        //自定义皮肤需要在其他组件渲染前设置
        GUI.skin = customSkin;

        //OnGUI 相关控件
        if(GUI.Button(new Rect(0,0,50,50),"按钮")){
            print("按钮被点击");
        }

        GUI.backgroundColor=Color.green;
        GUI.Button(new Rect(50, 50, 50, 50), "A button");
        GUI.backgroundColor=Color.gray;
        
        if(GUI.Button(new Rect(0,50,50,50),image)){
            print("图片按钮被点击");
        }

        if(GUI.Button(new Rect(0,100,50,50),new GUIContent("按钮",image))){
            print("图片+按钮+ToolTip");
        }   

        GUI.Box(new Rect(0, 150, 50, 50), "BOX");

        GUI.Box(new Rect(0, 200, 50, 50),image);

        GUI.Label(new Rect(0,250,50,50),"文本");
 
        GUI.Label(new Rect(0,300,50,50),image);

        _stringToEdit = GUI.TextField(new Rect(0,350,200,50),_stringToEdit,25);
 
        _stringToArea = GUI.TextArea(new Rect(0,400,200,150),_stringToArea);

        //scrollView
        Rect contentRect = new Rect(0, 0, 220, 200);
        _scrollPosition = GUI.BeginScrollView(new Rect(0, 550, 100, 100),
        _scrollPosition, contentRect);
        GUI.Button(new Rect(0, 0, 100, 20), "Top-left");
        GUI.Button(new Rect(120, 0, 100, 20), "Top-right");
        GUI.Button(new Rect(0, 180, 100, 20), "Bottom-left");
        GUI.Button(new Rect(120, 180, 100, 20), "Bottom-right");
        GUI.EndScrollView();


        //Slider
        _hSliderValue = GUI.HorizontalSlider(new Rect(0,650,100,20),_hSliderValue,0.0f,1.0f);
        _vSliderValue = GUI.VerticalSlider(new Rect(0,670,20,100),_vSliderValue,0.0f,1.0f);

        //ToolBar  页签按钮列表
        string [] toolBarString = new string[3] {"tip1","tip2","tip3"};
        _toolBarValue = GUI.Toolbar(new Rect(0,770,250,30),_toolBarValue,toolBarString);

        //可移动窗口
        _windowRect = GUI.Window(0,_windowRect,DoMyWindow,"标题");

        //3D 贴图
        GUI.DrawTexture(new Rect(300, 0, 100, 100), image);

        
        _checkBox = GUI.Toggle(new Rect(300, 100, 100, 30), _checkBox, "A Toggle text");
        _checkBox = !GUI.Toggle(new Rect(300, 150, 100, 30), !_checkBox, image);
 
    }

    void DoMyWindow(int windowId){
        GUI.DragWindow(new Rect(0,0,10000,20));
    }
}
 

```
![图片](..\assets\img\opengl\onGui.png)


# UGUI 常用控件  

UGUI 是 Unity 官方的 UI 实现方式，自从 Unity 4.6 起，Unity 官方推出了新版 UGUI 系统。

新版 UGUI 系统相比于 OnGUI 系统更加人性化，而且是一个开源系统，利用游戏开发人员进行游戏界面开发。

UGUI 系统有 3 个特点：灵活、快速、可视化。

对于游戏开发者来说，UGUI 运行效率高，执行效果好，易于使用，方便扩展，与 Unity 3D 兼容性高。
![图片](..\assets\img\opengl\NGUI.jpg)    
在 UGUI 中创建的所有 UI 控件都有一个 UI 控件特有的 Rect Transform 组件。

在 Unity 3D 中创建的三维物体是 Transform，而 UI 控件的 **Rect Transform** 组件是UI控件的矩形方位，其中的 PosX、PosY、PosZ 指的是 UI 控件在相应轴上的偏移量。

UI 控件除了 Rect Transform 组件外，还有一个 Canvas Renderer（画布渲染）组件，如上图所示。一般不用理会它，因为它不能被点开。  

## Canvas画布  
**Canvas 是画布，是摆放所有 UI 元素的区域，在场景中创建的所有控件都会自动变为 Canvas 游戏对象的子对象，若场景中没有画布，在创建控件时会自动创建画布。**

创建画布有两种方式：  
* 一是通过菜单直接创建；
* 二是直接创建一个 UI 组件时自动创建一个容纳该组件的画布。

不管用哪种方式创建画布，系统都会自动创建一个名为 **EventSystem** 的游戏对象，上面挂载了若干与事件监听相关的组件可供设置。  

它们分别对应画布的 3 种渲染模式：
* Screen Space-Overlay、
* Screen Space-Camera 
* World Space
![图片](..\assets\img\opengl\renderMode.jpg)    


### **Screen Space-Overlay 渲染模式**
在 Screen Space-Overlay 渲染模式下，场景中的 UI 被渲染到屏幕上，如果屏幕大小改变了或更改了分辨率，画布将自动更改大小以适配屏幕。

此种模式不需要 UI 摄像机，UI 将永远出现在所有摄像机的最前面。

Screen Space-Overlay 渲染模式的参数如下表所示。

参 数|	功 能
:-|:-
**Pixel Perfect**	|重置元素大小和坐标，使贴图的像素完美对应到屏幕像素上
**Sort Order**|	排列顺序

### **Screen Space-Camera 渲染模式**
Screen Space-Camera 渲染模式类似于 Screen Space-Overlay 渲染模式。  

这种渲染模式下，画布被放置在指定摄像机前的一个给定距离上，**它支持在 UI 前方显示 3D 模型与粒子系统等内容**，通过指定的摄像机 UI 被呈现出来，如果屏幕大小改变或更改了分辨率，画布将自动更改大小以适配屏幕。  
Screen Space-Camera 渲染模式的参数如下表所示。
参 数|功 能
:-|:-
Pixel Perfect | 重置元素大小和坐标，使贴图的像素完美对应到屏幕像素上
Render Camera | UI 绘制所对应的摄像机
Plane Distance | UI 距离摄像机镜头的距离
Sorting Layer | 界面分层，执行 Edit→Project Setting→Tags and Layers→Sorting Layers 命令进 行界面分层，越下方的层在界面显示时越在前面
Order Layer | 界面顺序，该值越高，在界面显示时越在前面

### **World Space 渲染模式**
在 World Space 渲染模式下呈现的 UI 好像是 3D 场景中的一个 Plane 对象。与前两种渲染模式不同，其屏幕的大小将取决于拍摄的角度和相机的距离。

它是一个完全三维的 UI，也就是把 UI 也当成三维对象，例如摄像机离 UI 远了，其显示就会变小，近了就会变大。

World Space 渲染模式的参数如下表所示。
参 数|功 能
:-|:-
**Event Camera**|设置用来处理用户界面事件的摄像机
**Sorting Layer**|界面分层，执行 Edit→Project Setting→Tags and Layers→Sorting Layers 命令进 行界面分层，越下方的层在界面显示时越在前面
**Order Layer**|界面顺序，该值越高，在界面显示时越在前面  

## Event System事件系统 
创建 UGUI 控件后，Unity 3D 会同时创建一个叫 Event System（事件系统）的 GameObject，用于控制各类事件。

如下图所示。可以看到 Unity 3D 自带了两个 Input Module，一个用于响应标准输入，另一个用于响应触摸操作。  

![图片](..\assets\img\opengl\eventSystem.jpg)    

Input Module 封装了 Input 模块的调用，根据用户操作触发各 Event Trigger。  
Event System 事件处理器中有 3 个组件：
1. **Event System** 事件处理组件
    是一种将基于输入的事件发送到应用程序中的对象，使用键盘、鼠标、触摸或自定义输入均可。
2. **Standalone Input Module（独立输入模块）**
    用于鼠标、键盘和控制器。该模块被配置为查看 InputManager，基于输入 InputManager 管理器的状态发送事件。
3. **Touch Input Module（触控输入模块）**
    被设计为使用在可触摸的基础设备上。


## UGUI 无法通过代码创建,如果要动态创建只能依托于prefab来动态创建


