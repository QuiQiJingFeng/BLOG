---
layout: post
title:  "OpenGL 3D场景坐标到2D屏幕坐标的过程研究"
image: ''
date:   2021-03-31 11:16:03
tags:
- OpenGL
description: ''
categories: 
- OpenGL
---


**已知 FOV(俯仰角) W/H 宽高比  近平面  远平面**
1. FOV的角度和近平面的距离可以算出近平面的高度H
2. 根据宽高比 可以确定近平面的宽度
3. 之后再根据摄像机的朝向和摄像机在世界坐标系中的位置，可以唯一确定近平面/远平面组成的半锥体的位置,**这个半锥体被称为'透视平截头体'**  

**以摄像机为原点，摄像机朝向方向为Z轴负方向，相机的左边为X轴方向，相机的上边为Y轴正方向组成的坐标系被称为'视觉坐标系' 或者 '观察坐标系'**

假设平截头体内部有一点P(x0,y0,z0),同时近平面的Z轴坐标是已知的-n,  
那么可以通过相似三角型求出在近平面上的投影坐标Q
Q = ( (n*x0) / (-z0) , (n*y0) / (-z0) )

已知近平面的宽度W,可知近平面最左边的坐标为-W/2,右边为W/2  
假设L表示最左边的坐标，R表示最右边的坐标,  
那么只需要将[L,R] 映射到[-1,1]的范围内,那么就可以将投影坐标Q的X坐标映射到[-1,1]当中，  
同理对Z轴做同样的操作可以将投影坐标Q的Y坐标映射到[-1,1]当中  

我们将平截头体在视觉空间的坐标在近平面的投影坐标 约束到(-1,1)的范围内 即:转换成标准设备坐标系(NDC)

最后标准设备坐标系[-1,-1] 映射到屏幕坐标空间当中  这个过程被称为'视口变换'