---
layout: post
title:  "Cocos 注意事项"
image: ''
date:   2024-02-22 10:36:17
tags:
- Cocos
description: ''
categories: 
- Cocos
---

# 1、关闭多点触摸
```objective-c
//AppController.mm
[eaglView setMultipleTouchEnabled:YES];
```
```java
//AppActivity.java
myActivity.getGLSurfaceView().setMultipleTouchEnabled(false);
```

# 2、设置屏幕常亮
```objective-c
//AppController.mm
[UIApplication sharedApplication].idleTimerDisabled = YES;
```
```java
//AppActivity.java
myActivity.setKeepScreenOn(true);
```

# 3、网络检测功能
LDNetDiagnoService
[ios](https://github.com/Lede-Inc/LDNetDiagnoService_IOS)
[android](https://github.com/Lede-Inc/LDNetDiagnoService_Android)


# 4、MD5检测
```c++
//ccUtils.h
std::string getFileMD5Hash(const std::string &filename)
{
    Data data;
    FileUtils::getInstance()->getContents(filename, &data);

    return getDataMD5Hash(data);
}
```

# 5、curl 断点续传

# 6、启动页图片
```xml
<!-- AndroidManifest.xml -->
<activity
    android:theme="@style/AppActivityTheme"
    >
</activity>

<!-- styles.xml -->
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <style name="AppActivityTheme" parent="@android:style/Theme.NoTitleBar.Fullscreen">
        <item name="windowNoTitle">true</item>
        <item name="android:windowFullscreen">true</item>
        <item name="android:windowBackground">@drawable/splash</item>
    </style>
</resources>

<!-- drawable/splash.png -->
```
ios
General->App Icons and Launch Images->Launch Images Sources -> LaunchImage

# 7、app名称和icon
<!-- android -->
```xml
<application
        android:icon="${app_icon}"
        android:label="${app_name}">

<!-- values/strings.xml -->
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <string name="app_name">应用名称</string>
    <string name="app_name_d">应用名称(d)</string>
</resources>
```
<!-- build.gradle -->
```gradle
productFlavors {
        dev {
            applicationId "com.mengya.game.dev"
            manifestPlaceholders = [
                                    app_icon    : "@mipmap/icon1",
                                    app_name    : "@string/app_name_d"
        }
        product {
            applicationId "com.mengya.game"
            manifestPlaceholders = [
                                    app_icon    : "@mipmap/icon2",
                                    app_name    : "@string/app_name"
        }
}
```
<!-- ios -->
* 将图标添加到 Xcode 项目：
打开 Xcode，选择你的项目文件，在项目导航器中选择 "Assets.xcassets"。在 "AppIcon" 区域，将相应尺寸的图标文件拖放到对应的槽位中。

* 验证图标设置：
在 Info.plist 文件中确保 CFBundleIcons 或 CFBundleIconFiles 键指向你的图标文件。你可以在 Xcode 中通过选择项目，然后在 "General" 标签下找到 "App Icons and Launch Images" 部分来验证图标的设置。

* 更改应用程序名称：
在 Xcode 中，选择你的项目文件，然后在 "General" 标签下，找到 "Display Name" 字段。在这里，你可以更改应用程序的显示名称。


* 更改 Bundle Display Name：
在 Info.plist 文件中，确保 CFBundleDisplayName 键的值是你想要显示的应用程序名称。

```xml
<key>CFBundleDisplayName</key>
<string>Your App Name</string>
```
或者，你也可以通过代码动态设置应用程序名称，例如在 AppDelegate.m 中的 application:didFinishLaunchingWithOptions: 方法中：
```objective-c
[[NSBundle mainBundle] setInfoDictionaryObject:@"Your App Name" forKey:@"CFBundleDisplayName"];
```

# 8、deep link
<!-- android -->
```xml
<activity
    android:name="org.cocos2dx.lua.AppActivity">
    <intent-filter>
        <action android:name="android.intent.action.MAIN" />
        <category android:name="android.intent.category.LAUNCHER" />
    </intent-filter>

    <!--deeplink-->
    <intent-filter>
        <action android:name="android.intent.action.VIEW" />
        <category android:name="android.intent.category.DEFAULT" />
        <category android:name="android.intent.category.BROWSABLE" />
        <data android:scheme="${applicationId}"/>
    </intent-filter>
</activity>
```
```java
//AppActivity.java
@Override
protected void onNewIntent(Intent intent){
    super.onNewIntent(intent);
    setIntent(intent);

    Uri uri = getIntent().getData();
    String info = Util.parseUri(uri);
}
//adb shell am start -a android.intent.action.VIEW -d "com.mengya.game.debug://store" com.mengya.game.debug
//adb shell am start -a android.intent.action.VIEW -d "com.mengya.game.debug://" com.mengya.game.debug

public class AppActivity extends Cocos2dxActivity{
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        Uri uri = getIntent().getData();
        String info = Util.parseUri(uri);
    }
}
```

<!-- ios -->
* 配置 URL Scheme：
在 Xcode 中的你的项目设置（Project Settings）中，选择 "Info" 标签，然后在 "URL Types" 部分中添加一个 URL Scheme。
这个 URL Scheme 是一个标识符，用于识别你的应用程序。
例如，如果你的应用程序名称是 myapp，则可以设置 URL Scheme 为 myapp。

* 在 AppController 中处理 Deep Link：
在 AppController.mm 文件中，实现 application:openURL:options: 方法，该方法会在应用程序通过 Deep Link 启动时调用。
你需要检查传递给该方法的 URL，以确定需要执行的操作，并导航到相应的页面。

```objective-c
- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary<UIApplicationOpenURLOptionsKey,id> *)options {
    // 解析 URL，执行相应的操作
    if ([url.scheme isEqualToString:@"myapp"]) {
        // 处理你的 Deep Link 操作
        // 例如，提取 URL 中的参数并导航到特定页面
        NSString *path = url.path;
        // ...
        return YES;
    }
    return NO;
}
```

* 处理 Universal Links（可选）：
如果你想要支持 Universal Links（iOS 9 及以上版本支持的一种更先进的 Deep Linking 方法），你可以在 AppController.mm 中实现 application:continueUserActivity:restorationHandler: 方法。

```objective-c
- (BOOL)application:(UIApplication *)application continueUserActivity:(NSUserActivity *)userActivity restorationHandler:(void (^)(NSArray * _Nullable))restorationHandler {
    // 处理 Universal Links
    NSURL *url = userActivity.webpageURL;
    // 解析 URL，执行相应的操作
    if ([url.scheme isEqualToString:@"https"] && [url.host isEqualToString:@"example.com"]) {
        // 处理你的 Deep Link 操作
        // 例如，提取 URL 中的参数并导航到特定页面
        NSString *path = url.path;
        // ...
        return YES;
    }
    return NO;
}
```
* 在应用内处理 Deep Link：
无论是通过 URL Scheme 还是 Universal Links，一旦你在 AppController 中捕获到 Deep Link，就可以执行相应的操作。
这可能涉及解析 URL 中的参数，然后导航到特定的视图控制器或执行其他操作。

请注意，为了使 Universal Links 生效，你需要在 Xcode 中配置相关的 Associated Domains。 
这个配置允许应用程序关联特定的域名，并在用户点击链接时启动应用程序。

```xml
<key>com.apple.developer.associated-domains</key>
<array>
    <string>applinks:example.com</string>
</array>
```
# 9、android 活动销毁重建(手势切换或者内存不足的情况可能会出现活动被销毁,可以用开发者模式中的离开销毁活动模拟)
```java
public class AppActivity extends Cocos2dxActivity{
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        // 如果活动被销毁之后重建，直接重启应用
        if (savedInstanceState != null) {
            finish();
            Context ctx = getBaseContext();
            Intent i = ctx.getPackageManager().getLaunchIntentForPackage(ctx.getPackageName());
            i.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
            startActivity(i);
            android.os.Process.killProcess(android.os.Process.myPid());
            return;
        }
    }
}
```
# 10、android 渠道号写入
美团渠道号库 walle
```gradle
implementation 'com.meituan.android.walle:library:1.1.7'
```

# 11、android class mutidex
```gradle
implementation 'androidx.multidex:multidex:2.0.1'
```
```java
public class MyApplication extends Application {
    @Override
    protected void attachBaseContext(Context base) {
        super.attachBaseContext(base);
        MultiDex.install(this);
    }
}

```